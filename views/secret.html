<html>
<head>
  <meta charset="UTF-8">
  <title>Task Manager</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.min.js"></script>
  <script src="./js/index.js"></script>
</head>
<body>
  <div id="create">
    <input id="task" placeholder="enter new task" type="text"></input>
    <button id="task-button">Add Task</button>
    <button id="retrieve">Get Tasks</button>
  </div>
  <ul id="task-list"></ul>
</body>
<script>
  // I couldn't get the separate js file to work correctly for some reason
  // So here is my js right in the html file for now...
  document.getElementById("task-button").onclick = function addTask() {
    const newTask = {};
    newTask.item = document.getElementById('task').value;
    // console.log('adding ', newTask);
    fetch('/tasks', {
      method: 'POST',
      body: JSON.stringify(newTask),
      headers: { 'Content-Type': 'application/json' },
    })
      .then(res => res.json())
      .then(res => console.log(res));
    document.getElementById('task').value = '';
  }

  document.getElementById("retrieve").onclick = function displayTasks() {
    // To do: Make this only fetch once
    fetch('/tasks') 
    .then(res => res.json())
    .then(res => {
      res.rows.forEach((task) => {
        let li = document.createElement("li");
        let todo = document.createTextNode(task.item);
        let removeBtn = document.createElement("button");
        removeBtn.innerHTML = "X";
        removeBtn.setAttribute("class", "remove");
        removeBtn.setAttribute("id", task.id);
        removeBtn.onclick = function() {
          deleteTask(task.id);
          li.remove();
        }
        // removeBtn.onclick = deleteTask(task.item);
        li.appendChild(todo);
        document.getElementById("task-list").appendChild(li).appendChild(removeBtn);
      })
    });
  };

  function deleteTask(task) {
    const delTask = {};
    delTask.id = task;
    console.log('deleting ', delTask.id);
    // fetch('/delete', {
    //   method: 'POST',
    //   body: JSON.stringify(delTask),
    //   headers: { 'Content-Type': 'application/json' },
    // })
  }

</script>
</html>
